<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugin-html-keyboard-response.js"></script>
    <script src="jspsych/plugin-image-keyboard-response.js"></script> 
    <script src="jspsych/plugin-preload.js"></script>
    <link href="https://unpkg.com/jspsych@7.3.0/css/jspsych.css" rel="stylesheet" type="text/css" />
  </head>
  <body></body>
  <script>
    var jsPsych = initJsPsych({
        // here we declare within the initialization that we want this function to run at the end
        on_finish: function(){
            jsPsych.data.displayData(); //this is useful for directly debugging, probably not for real
        }
    });

    var timeline = [];

    
    // creating a pre-trial event that will preload our media
    var preload = {
        type: jsPsychPreload,
        images: ['img/blue.png', 'img/orange.png'] // here we simply list the files we want loaded
    };
    timeline.push(preload)
    
    var welcome = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: "Welcome to the experiment. Press any key to begin."
    };
    timeline.push(welcome);
    
    // the new variables are there to have breaks after each x trials
    var trial_count = 0;

    var break_trial = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus:  "<p style='font-size: 25px'>Time to take a break!</p>" + 
            "<p style='font-size: 25px'>Take a rest for about a minute. Press any key to continue.</p>",
    // choices: "c"
    };

    var break_conditional = {
        timeline: [break_trial],
        conditional_function: function() {
            // increment trial count - in first run through the timeline variables procedure, trial_count will be equal to 1
            trial_count++;
            if (trial_count % 1 == 0) {
            // if the trial count is divisible by 96, then run the break trial
            return true;
            } else {
            // otherwise skip the break trial
            return false;
            }
        }
    };

    var real_trials = {
        timeline: [break_conditional, test],
        timeline_variables: full_design
    };
    timeline.push(real_trials);

    var instructions = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
        <p>Hello! Here are some instructions. In this experiment, a circle will appear in the center of the screen.</p>
        <p> If the circle is <strong>blue</strong>, press the letter <em>F</em> as fast as you can.</p>
        <p>If the circle is <strong>orange</strong>, press the letter <b>J</b> as fast as you can.</p>
        <div style='width: 700px;'>
        <div style='float: left;'><img src='img/blue.png'></img>
        <p class='small'><strong>Press the F key</strong></p></div>
        <div style='float: right;'><img src='img/orange.png'></img>
        <p class='small'><strong>Press the J key</strong></p></div>
        </div>
        <p>Press any key to begin.</p>
        `,
        post_trial_gap: 2000
    };
    timeline.push(instructions)

    // delcaring a list of the stimuli we wish to run
    var test_stimuli = [
    { stimulus: "img/blue.png", correct_response: 'f'},
    { stimulus: "img/orange.png", correct_response: 'j'}
    ];

    // declaring a fixation cross trial
    var fixation = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: '<div style="font-size:60px;">+</div>',
    choices: "NO_KEYS", //specifies that no keyboard answer will be accepted
    // trial_duration: 1000, // if one wants a given, fixed duration each time
    trial_duration: function(){
        return jsPsych.randomization.sampleWithoutReplacement([250, 500, 750, 1000, 1250, 1500, 1750, 2000], 1)[0];
    }, // this function picks up one duration value at random
    data: 'fixation' // here we tag the fixation with a relevant name, useful to remove its data later
    };
    
    var test = {
    type: jsPsychImageKeyboardResponse,
    stimulus: jsPsych.timelineVariable('stimulus'),
    choices: ['f', 'j'],
    data: { //here we give tags that will be useful to our data
        task: 'response',
        correct_response: jsPsych.timelineVariable('correct_response')
    },
    on_finish: function(data){ //this function calculates online whether the answer is correct or not
        data.correct = jsPsych.pluginAPI.compareKeys(data.response, data.correct_response);
    }
    };

    var test_procedure = {
    timeline: [fixation, test],
    timeline_variables: test_stimuli,
    randomize_order: true, //set to true to randomize the order of 'test stimuli'
    repetitions: 4 //how many times to repeat the full sequence of timeline variables
    }
    timeline.push(test_procedure)

    var data = jsPsych.data.get().filter({trial_type: 'image-keyboard-response'});

    // here we had individual trials declared. next we declare them in 'test'
    // var blue_trial = {
    // type: jsPsychImageKeyboardResponse,
    // stimulus: 'img/blue.png',
    // choices: ['f', 'j']
    // };

    // var orange_trial = {
    // type: jsPsychImageKeyboardResponse,
    // stimulus: 'img/orange.png',
    // choices: ['f', 'j']
    // };

    // timeline.push(blue_trial, orange_trial)

    jsPsych.run(timeline);
  </script>
</html>
